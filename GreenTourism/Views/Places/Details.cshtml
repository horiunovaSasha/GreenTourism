@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    @model GreenTourism.Models.PlaceViewModel
}

<main id="main">
    <section id="breadcrumbs" class="breadcrumbs">
        <div class="breadcrumb-hero">
            <div class="container">
                <div class="breadcrumb-hero">
                    <h2>@Model.Name</h2>
                </div>
            </div>
        </div>
        <div class="container">
            <ol>
                <li><a href="index.html">Головна</a></li>
                <li>@Model.Name</li>
            </ol>
        </div>
    </section><!-- End Breadcrumbs -->
    <section id="portfolio-details" class="portfolio-details">
        <div class="container">

            <div class="portfolio-details-container">
                <div class="owl-carousel portfolio-details-carousel">
                    @foreach (var image in Model.PlacePhotos)
                    {
                        <img src="~/img/places/@image.Photo.Path" class="img-fluid" alt="">
                    }
                </div>

                <div class="portfolio-info">
                    <h3>Інформація</h3>
                    <ul>
                        <li><strong>Назва</strong>: @Model.Name</li>
                        <li><strong>Опис</strong>: @Model.Description</li>
                        @*<li><strong>Регіон</strong>: @Model.Region.Name </li>*@
                        <li><strong>Рейтинг</strong>: @Model.Rating </li>
                    </ul>
                </div>

            </div>

            <div class="portfolio-description">
                <h2>Загальний опис місця</h2>
                <p>
                    @Model.Description
                </p>
            </div>
            <div>
                <iframe style="border:0; width: 100%; height: 270px;" src="@Model.LocationCoords" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>
    </section>

    <section id="blog" class="blog">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 entries">
                    <div class="blog-comments" id="blog-comments">

                        <h4 class="comments-count">Кількість коментарів: @Model.PlaceComments.Count</h4>

                        @foreach (var comment in Model.PlaceComments.Select(x => x.Comment))
                        {
                        <div class="comment clearfix">
                            <img src="~/img/comments-1.jpg" class="comment-img  float-left" alt="">
                            <h5><a href="">Georgia Reader</a></h5>
                            <time datetime="@comment.CreatedDate">@comment.CreatedDate</time>
                            <p>
                                @comment.Text
                            </p>

                        </div>
                        }
                        @*<div id="comment-2" class="comment clearfix">
                            <img src="~/img/comments-2.jpg" class="comment-img  float-left" alt="">
                            <h5><a href="">Aron Alvarado</a> <a href="#" class="reply"><i class="icofont-reply"></i> Reply</a></h5>
                            <time datetime="2020-01-01">01 Jan, 2020</time>
                            <p>
                                Ipsam tempora sequi voluptatem quis sapiente non. Autem itaque eveniet saepe. Officiis illo ut beatae.
                            </p>

                            <div id="comment-reply-1" class="comment comment-reply clearfix">
                                <img src="~/img/comments-3.jpg" class="comment-img  float-left" alt="">
                                <h5><a href="">Lynda Small</a> <a href="#" class="reply"><i class="icofont-reply"></i> Reply</a></h5>
                                <time datetime="2020-01-01">01 Jan, 2020</time>
                                <p>
                                    Enim ipsa eum fugiat fuga repellat. Commodi quo quo dicta. Est ullam aspernatur ut vitae quia mollitia id non. Qui ad quas nostrum rerum sed necessitatibus aut est. Eum officiis sed repellat maxime vero nisi natus. Amet nesciunt nesciunt qui illum omnis est et dolor recusandae.

                                    Recusandae sit ad aut impedit et. Ipsa labore dolor impedit et natus in porro aut. Magnam qui cum. Illo similique occaecati nihil modi eligendi. Pariatur distinctio labore omnis incidunt et illum. Expedita et dignissimos distinctio laborum minima fugiat.

                                    Libero corporis qui. Nam illo odio beatae enim ducimus. Harum reiciendis error dolorum non autem quisquam vero rerum neque.
                                </p>
                            </div>
                        </div>*@
                        @if (SignInManager.IsSignedIn(User))
                        {
                            <div class="reply-form">
                                <h4>Залишити коментар</h4>
                                <form action="">
                                    <div class="row">
                                        <div class="col form-group">
                                            <textarea name="CurrentComment" class="form-control" placeholder="Ваш коментар*" id="CurrentComment"></textarea>
                                        </div>
                                    </div>
                                    <a href="#" onclick="return sendComment()" class="btn btn-primary">Опублікувати</a>
                                </form>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script type="text/javascript">
        function sendComment() {
            $.ajax({
                type: "POST",
                url: "/api/comment?placeId=@Model.Id",
                data: JSON.stringify({
                    Text: $("#CurrentComment").val()
                }),
                success: function (response) {
                    var div = '<div class="comment clearfix">' +
                        '<img src="/img/comments-2.jpg" class="comment-img float-left" alt="test">' +
                        '<h5><a href="#">Oleksandra Koshman</a></h5>' +
                        '<time datetime="' + response.createdDate +'">'+ response.createdDate +'</time>' +
                        '<p>' + response.text + '</p>' +
                        '</div>';

                    $(div).insertBefore(".reply-form")
                },
                contentType: "application/json",
                dataType: "json",
            });

            return false;
        }
    </script>
</main>